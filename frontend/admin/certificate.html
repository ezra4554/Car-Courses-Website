<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page Admin</title>
    <link rel="stylesheet" href="../assets/css/style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="nav-top flex items-center h-auto w-full">
      <div class="logo">
        <div class="img-logo"></div>
        <a class="text-white" href="index.html">LOGO</a>
      </div>
      <ul>
        <li><a class="text-white" href="./index.html">HOME</a></li>
        <li><a class="text-white" href="../about.html">ABOUT</a></li>
        <li>
          <a class="text-white" href="../contact.html">CONTACT</a>
        </li>
        <li><a class="text-white login" href="../auth.html">LOGIN</a></li>
      </ul>
    </div>

    <div class="grid grid-flow-col w-screen">
      <div
        class="sidebar h-screen w-[250px] bg-neutral-500 top-0 bot-0 overflow-y-auto text-white"
      >
        <div class="text-xl mt-5 justify-center flex">
          <div class="img-logo"></div>
          <h1>Hai, Admin!</h1>
        </div>
        <hr class="my-2 text-gray-600 text-start" />
        <div class="flex flex-col justify-center mx-3">
          <h1 class="text-amber-200">MAIN</h1>
          <div
            class="menu cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
            id="menuDashboard"
          >
            <i class="fa-solid fa-house mr-3"></i>
            Dashboard
          </div>
          <div
            class="menu-dropdown cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
          >
            <i class="fa-solid fa-users mr-3"></i>
            Manage Customer
            <i class="fa-solid fa-chevron-right ml-2"></i>
          </div>
          <ul class="drop-down max-h-0 overflow-y-hidden ml-2">
            <li
              class="text-sm ml-9 cursor-pointer hover:bg-[#BCBCBC] rounded-md mt-2"
              id="menuAddCustomer"
            >
              Add Customer
            </li>
            <li
              class="text-sm ml-9 mt-1 cursor-pointer hover:bg-[#BCBCBC] rounded-md"
              id="menuUpdateCustomer"
            >
              Update Customer
            </li>
          </ul>
          <div
            class="menu-dropdown cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
          >
            <i class="fa-solid fa-user-tie mr-3"></i>
            Manage Mentor
            <i class="fa-solid fa-chevron-right ml-8"></i>
          </div>
          <ul class="drop-down max-h-0 overflow-y-hidden ml-2">
            <li
              class="text-sm ml-8 cursor-pointer hover:bg-[#BCBCBC] rounded-md mt-1"
              id="menuAddMentor"
            >
              Add Mentor
            </li>
            <li
              class="text-sm ml-8 mt-1 cursor-pointer hover:bg-[#BCBCBC] rounded-md"
              id="menuUpdateMentor"
            >
              Update Mentor
            </li>
          </ul>
          <h1 class="text-amber-200">SETTINGS</h1>
          <div
            class="menu cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
            id="menuSchedule"
          >
            <i class="fa-solid fa-calendar-days mr-3"></i>
            Set Schedule
          </div>
          <div
            class="menu cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
            id="menuCertificate"
          >
            <i class="fa-solid fa-print mr-3"></i>
            Release Certificate
          </div>
          <div class="">
            <div
              class="menu cursor-pointer hover:bg-[#BCBCBC] rounded-md ease-in duration-200 p-2"
              id="menuProfile"
            >
              <i class="fa-solid fa-gear mr-3"></i>
              Profile
            </div>
            <div
              class="menu cursor-pointer hover:bg-[#BCBCBC] active:bg-blue-600 rounded-md ease-in duration-200 p-2"
              id="menuLogout"
            >
              <i class="fa-solid fa-right-from-bracket mr-3"></i>
              Logout
            </div>
          </div>
        </div>
      </div>
      <div id="content" class="content w-full">
        <h1 class="text-xl">Certificate</h1>
        <h2>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptate,
          distinctio repudiandae illo cupiditate itaque in vero quibusdam
          pariatur est eum cum voluptatem sit delectus perspiciatis odio minima,
          ullam, ab sed.
        </h2>
        <div
          class="mb-5 max-h-[400px] overflow-y-auto bg-white border-3 shadow-xl rounded-xl p-5"
        >
          <button class="btn-refresh bg-gray-300 mt-5 p-2 rounded-lg">
            <i class="fa-solid fa-rotate-right"></i>
          </button>
          <table class="w-full table-fixed">
            <thead>
              <tr>
                <th class="border-b text-start">NO</th>
                <th class="border-b text-start">NAMA</th>
                <th class="border-b text-start">TANGGAL <br />LAHIR</th>
                <th class="border-b text-start">ROLE</th>
                <th class="border-b text-start">KET</th>
                <th class="border-b text-start">ACTION</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      let customers;
      let user;
      const btnRefresh = document.querySelector(".btn-refresh");
      btnRefresh.onclick = async () => {
        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = ""; //refresh ulang
        try {
          const res = await fetch(
            "https://api-coba.ezra4554.repl.co/api/auth/",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          if (!res.ok) {
            throw new Error(`HTTP error! Status: ${res.status}`);
          }
          const data = await res.json();
          customers = data.users.filter((user) => user.role === "Customer");
          customers.forEach((user, index) => {
            const row = document.createElement("tr");
            const date = new Date(user.tgl_lahir);
            const formattedDate = date.toLocaleDateString("en-GB");
            row.innerHTML = `
                    <td class="border-b break-words">${index + 1}</td>
                    <td class="border-b break-words">${user.name}</td>
                    <td class="border-b break-words">${formattedDate}</td>
                    <td class="border-b break-words">${user.role}</td>
                    <td class="border-b break-words">${user.keterangan}</td>
                    <td class="border-b break-words"><i class="fa-solid fa-file-arrow-down bg-blue-400 p-2 rounded-lg hover:bg-blue-300 cursor-pointer" onclick="downloadBtn(${index})"
        ></i></td>
                    
                  `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error("Error:", error);
        }
      };
      function downloadBtn(index) {
        const user = customers[index];
        window.jsPDF = window.jspdf.jsPDF;
        let doc = new jsPDF({
          orientation: "landscape",
        });

        // SET Tanggal
        const today = new Date();
        const optionsDate = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        const formattedDate = today.toLocaleDateString("id-ID", optionsDate);

        // Set font and font size for the entire document
        doc.setFont("times", "normal");

        // Header
        doc.setFontSize(30);
        doc.text("SERTIFIKAT", 110, 80, { align: "center" });

        // User Name
        doc.setFontSize(25);
        const nameCertif = user.name.toUpperCase();
        doc.text(nameCertif, 110, 100, { align: "center" });

        // Keterangan
        doc.setFont("times", "italic");
        doc.setFontSize(25);
        doc.text("LULUS", 110, 110, { align: "center" });

        // Tanggal
        doc.setFont("times", "bold");
        doc.setFontSize(20);
        doc.text(`Tanggal ${formattedDate}`, 110, 130, { align: "center" });

        doc.save(`Certificate ${nameCertif}, ${formattedDate}`);
      }
    </script>
    <!-- //<script src="anime.min.js"></script> -->
  </body>
</html>
